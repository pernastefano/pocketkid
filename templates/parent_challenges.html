{% extends 'base.html' %}
{% block title %}{{ _('challenge_settings') }} - {{ _('app_name') }}{% endblock %}
{% block content %}
<nav class="actions-row">
  <a class="btn btn-secondary" href="{{ url_for('dashboard') }}">{{ _('back_dashboard') }}</a>
</nav>

<section class="card">
  <h2>{{ _('new_challenge') }}</h2>
  <form method="post" class="stack">
    <label>{{ _('challenge_name') }}
      <input name="name" required>
    </label>
    <label>{{ _('default_reward') }}
      <input type="number" name="amount" step="0.01" min="0.01" required>
    </label>
    <button class="btn" type="submit">{{ _('add_challenge') }}</button>
  </form>
</section>

<section class="card">
  <h2>{{ _('configured_challenges') }}</h2>
  <div class="list">
    {% for challenge in challenges %}
      <div class="list-item block challenge-card">
        <div class="challenge-top-row">
          <div>
          <p class="label">{{ challenge.name }}</p>
          <p class="muted">{{ challenge.created_at.strftime('%d/%m/%Y') }}</p>
          </div>
          <p class="amount {{ 'positive' if challenge.amount >= 0 else 'negative' }}">{{ challenge.amount|eur }}</p>
        </div>
        <div class="inline-actions challenge-actions">
          <form method="post" action="{{ url_for('toggle_challenge', challenge_id=challenge.id) }}">
            <button class="btn btn-secondary" type="submit">{{ _('deactivate') if challenge.active else _('activate') }}</button>
          </form>
          <form method="post" action="{{ url_for('delete_challenge', challenge_id=challenge.id) }}" data-confirm="{{ _('confirm_delete_generic') }}" onsubmit="return confirm(this.dataset.confirm)">
            <button class="btn btn-secondary" type="submit">{{ _('delete') }}</button>
          </form>
        </div>
      </div>
    {% else %}
      <p class="muted">{{ _('no_challenges') }}</p>
    {% endfor %}
  </div>
  {% if challenges_pagination.pages > 1 %}
  <nav class="pagination-row">
    {% if challenges_pagination.has_prev %}
      <a class="btn btn-secondary" href="{{ url_for('parent_challenges', page=challenges_pagination.prev_num) }}">{{ _('prev') }}</a>
    {% else %}
      <span></span>
    {% endif %}
    <span class="muted pagination-label">{{ challenges_pagination.page }}/{{ challenges_pagination.pages }}</span>
    {% if challenges_pagination.has_next %}
      <a class="btn btn-secondary" href="{{ url_for('parent_challenges', page=challenges_pagination.next_num) }}">{{ _('next') }}</a>
    {% else %}
      <span></span>
    {% endif %}
  </nav>
  {% endif %}
</section>
{% endblock %}
