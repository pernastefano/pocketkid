{% extends 'base.html' %}
{% block title %}{{ _('dashboard_child') }} - {{ _('app_name') }}{% endblock %}
{% block content %}
<section class="card balance-card">
  <p class="muted">{{ _('available_balance') }}</p>
  <p class="balance">{{ wallet.balance|eur }}</p>
</section>

<section class="card">
  <h2>{{ _('requests_label') }}</h2>
  <div class="icon-actions" data-request-toggle-group="true">
    <button class="btn btn-secondary icon-action" type="button" data-request-toggle="reward" title="{{ _('request_reward') }}" aria-label="{{ _('request_reward') }}"><i class="bi bi-trophy" aria-hidden="true"></i></button>
    <button class="btn btn-secondary icon-action" type="button" data-request-toggle="withdrawal" title="{{ _('request_withdrawal') }}" aria-label="{{ _('request_withdrawal') }}"><i class="bi bi-cash-coin" aria-hidden="true"></i></button>
    <button class="btn btn-secondary icon-action" type="button" data-request-toggle="deposit" title="{{ _('request_deposit') }}" aria-label="{{ _('request_deposit') }}"><i class="bi bi-plus-circle" aria-hidden="true"></i></button>
  </div>
</section>

<section class="card hidden" data-request-form="reward">
  <h2>{{ _('request_reward') }}</h2>
  <form method="post" action="{{ url_for('child_request_reward') }}" class="stack">
    <label>{{ _('completed_challenge_label') }}
      <select name="challenge_id" required>
        {% for challenge in challenges %}
          <option value="{{ challenge.id }}">{{ challenge.name }} Â· {{ challenge.amount|eur }}</option>
        {% endfor %}
      </select>
    </label>
    <label>{{ _('note') }}
      <input name="description">
    </label>
    <button class="btn" type="submit">{{ _('send_reward_request') }}</button>
  </form>
</section>

<section class="card hidden" data-request-form="withdrawal">
  <h2>{{ _('request_withdrawal') }}</h2>
  <form method="post" action="{{ url_for('child_request_withdrawal') }}" class="stack">
    <label>{{ _('amount') }}
      <input type="number" step="0.01" min="0.01" name="amount" required>
    </label>
    <label>{{ _('reason') }}
      <input name="description">
    </label>
    <button class="btn" type="submit">{{ _('send_withdrawal_request') }}</button>
  </form>
</section>

<section class="card hidden" data-request-form="deposit">
  <h2>{{ _('request_deposit') }}</h2>
  <form method="post" action="{{ url_for('child_request_deposit') }}" class="stack">
    <label>{{ _('amount') }}
      <input type="number" step="0.01" min="0.01" name="amount" required>
    </label>
    <label>{{ _('description') }}
      <input name="description">
    </label>
    <button class="btn" type="submit">{{ _('send_deposit_request') }}</button>
  </form>
</section>

<section class="card">
  <h2>{{ _('requests_status') }}</h2>
  <div class="list">
    {% for req in requests %}
      <div class="list-item request-item">
        <p class="label request-kind">{{ _('request_type_reward') if req.request_type == 'reward' else (_('request_type_withdrawal') if req.request_type == 'withdrawal' else _('request_type_deposit')) }}</p>
        <p class="badge {{ req.status }} request-status">{{ req.status }}</p>
        <p class="muted request-description">{{ req.description }}</p>
        <p class="muted request-time">{{ req.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
        <p class="amount request-amount {{ 'positive' if req.request_type in ['reward', 'deposit'] else 'negative' }}">{{ req.amount|eur }}</p>
      </div>
    {% else %}
      <p class="muted">{{ _('no_requests') }}</p>
    {% endfor %}
  </div>
  {% if requests_pagination.pages > 1 %}
  <nav class="pagination-row">
    {% if requests_pagination.has_prev %}
      <a class="btn btn-secondary" href="{{ url_for('dashboard', requests_page=requests_pagination.prev_num, transactions_page=transactions_pagination.page) }}">{{ _('prev') }}</a>
    {% else %}
      <span></span>
    {% endif %}
    <span class="muted pagination-label">{{ requests_pagination.page }}/{{ requests_pagination.pages }}</span>
    {% if requests_pagination.has_next %}
      <a class="btn btn-secondary" href="{{ url_for('dashboard', requests_page=requests_pagination.next_num, transactions_page=transactions_pagination.page) }}">{{ _('next') }}</a>
    {% else %}
      <span></span>
    {% endif %}
  </nav>
  {% endif %}
</section>

<section class="card">
  <h2>{{ _('history') }}</h2>
  <div class="list">
    {% for tx in transactions %}
      <div class="list-item">
        <div>
          <p class="label">{{ tx.description }}</p>
          <p class="muted">{{ tx.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
        </div>
        <p class="amount {{ 'positive' if tx.amount >= 0 else 'negative' }}">{{ tx.amount|eur }}</p>
      </div>
    {% else %}
      <p class="muted">{{ _('no_operations') }}</p>
    {% endfor %}
  </div>
  {% if transactions_pagination.pages > 1 %}
  <nav class="pagination-row">
    {% if transactions_pagination.has_prev %}
      <a class="btn btn-secondary" href="{{ url_for('dashboard', requests_page=requests_pagination.page, transactions_page=transactions_pagination.prev_num) }}">{{ _('prev') }}</a>
    {% else %}
      <span></span>
    {% endif %}
    <span class="muted pagination-label">{{ transactions_pagination.page }}/{{ transactions_pagination.pages }}</span>
    {% if transactions_pagination.has_next %}
      <a class="btn btn-secondary" href="{{ url_for('dashboard', requests_page=requests_pagination.page, transactions_page=transactions_pagination.next_num) }}">{{ _('next') }}</a>
    {% else %}
      <span></span>
    {% endif %}
  </nav>
  {% endif %}
</section>
{% endblock %}
